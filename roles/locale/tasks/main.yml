---
- name: Ensure locale exists
  community.general.locale_gen:
    name: '{{ os.locale }}'
    state: present
  become: true
  tags: locale

- name: Check if LANG is already set
  ansible.builtin.lineinfile:
    name: /etc/default/locale
    line: "LANG={{ os.locale }}"
    state: present
  check_mode: true
  notify:
    - update locale
  tags: locale

- name: Check if LC_ALL is already set
  ansible.builtin.lineinfile:
    name: /etc/default/locale
    line: "LC_ALL={{ os.locale }}"
    state: present
  check_mode: true
  notify:
    - update locale
  tags: locale

- name: Check if LANGUAGE is already set
  ansible.builtin.lineinfile:
    name: /etc/default/locale
    line: "LANGUAGE={{ os.locale }}"
    state: present
  check_mode: true
  register: lc_all
  tags: locale

- name: Flush handlers
  ansible.builtin.meta: flush_handlers
  tags: locale
